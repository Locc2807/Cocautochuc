<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/fragment/head :: head"></head>
<body>
	<div class="wrapper">

		<!-- Sidebar -->
		<div th:replace="admin/fragment/aside :: aside"></div>

		<!-- Main panel -->
		<div class="main-panel">

			<!-- Header -->
			<div th:replace="admin/fragment/header :: header"></div>

			<div class="container">
				<div class="page-inner">

					<div class="page-header">
						<h4 class="page-title">üíª T√≠nh h·ªçc ph√≠ t·ª± ƒë·ªông</h4>
					</div>

					<!-- FORM CH·ªåN CTƒêT V√Ä H·ªåC K·ª≤ -->
					<div class="card p-3 mb-4">
						<form th:action="@{/admin/tuition/calculate}" method="get"
							class="row g-3">

							<!-- Ch·ªçn CTƒêT -->
							<div class="col-md-6">
								<label for="curriculumCode" class="form-label">Ch·ªçn
									ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o</label> <select name="curriculumCode"
									id="curriculumCode" class="form-select" required>
									<option value="" disabled selected>-- Ch·ªçn CTƒêT --</option>
									<option th:each="c : ${curricula}"
										th:value="${c.curriculumCode}"
										th:text="${c.curriculumCode + ' - ' + c.major.name}"></option>
								</select>
							</div>

							<!-- Ch·ªçn h·ªçc k·ª≥ -->
							<div class="col-md-4">
								<label for="semester" class="form-label">Ch·ªçn h·ªçc k·ª≥</label> <select
									name="semester" id="semester" class="form-select" required>
									<option value="" disabled selected>-- Ch·ªçn h·ªçc k·ª≥ --</option>
									<option th:each="t : ${tuitionFormulas}"
										th:value="${t.semester}" th:text="${t.semester}"></option>
								</select>
							</div>

							<!-- Xem t·ªïng t√≠n ch·ªâ -->
							<div class="col-md-2 d-flex align-items-end">
								<button type="button" id="showCredits"
									class="btn btn-info w-100">Xem t·ªïng t√≠n ch·ªâ</button>
							</div>

							<!-- Hi·ªÉn th·ªã t·ªïng t√≠n ch·ªâ -->
							<div class="col-12 mt-3" id="creditResult" style="display: none;">
								<p>
									T·ªïng t√≠n ch·ªâ: <span id="totalCredits"></span>
								</p>
							</div>

							<!-- T√≠nh h·ªçc ph√≠ -->
							<div class="col-12 mt-2 d-flex">
								<button type="submit" class="btn btn-primary w-100">T√≠nh
									h·ªçc ph√≠</button>
							</div>
						</form>
					</div>

					<!-- K·∫æT QU·∫¢ H·ªåC PH√ç -->
					<div th:if="${tuitionAmount != null}" class="card p-3 mt-4">
						<h5>K·∫øt qu·∫£ h·ªçc ph√≠</h5>
						<p>
							<strong>Ch∆∞∆°ng tr√¨nh:</strong> <span th:text="${curriculumCode}"></span>
						</p>
						<p>
							<strong>H·ªçc k·ª≥:</strong> <span th:text="${semester}"></span>
						</p>
						<p>
							<strong>T·ªïng t√≠n ch·ªâ:</strong> <span th:text="${totalCredits}"></span>
						</p>
						<p>
							<strong>H·ªçc ph√≠ 1 t√≠n ch·ªâ:</strong> <span
								th:text="${#numbers.formatDecimal(tuitionPerCredit, 0, 'COMMA', 2, 'POINT')}"></span>
							VNƒê
						</p>
						<h4>
							üí∞ T·ªïng h·ªçc ph√≠: <span
								th:text="${#numbers.formatDecimal(tuitionAmount, 0, 'COMMA', 2, 'POINT')}"></span>
							VNƒê
						</h4>
						<a th:href="@{/admin/tuition/calculate_form}"
							class="btn btn-secondary mt-3">T√≠nh l·∫°i</a>
					</div>

				</div>
			</div>

			<!-- Footer -->
			<div th:replace="admin/fragment/footer :: footer"></div>
		</div>
	</div>

	<!-- Core JS -->
	<script th:src="@{/assets/js/core/jquery-3.7.1.min.js}"></script>
	<script th:src="@{/assets/js/core/popper.min.js}"></script>
	<script th:src="@{/assets/js/core/bootstrap.min.js}"></script>

	<!-- Plugins -->
	<script
		th:src="@{/assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js}"></script>
	<script th:src="@{/assets/js/plugin/chart.js/chart.min.js}"></script>
	<script
		th:src="@{/assets/js/plugin/jquery.sparkline/jquery.sparkline.min.js}"></script>
	<script th:src="@{/assets/js/plugin/chart-circle/circles.min.js}"></script>
	<script th:src="@{/assets/js/plugin/datatables/datatables.min.js}"></script>
	<script
		th:src="@{/assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js}"></script>
	<script th:src="@{/assets/js/plugin/jsvectormap/jsvectormap.min.js}"></script>
	<script th:src="@{/assets/js/plugin/jsvectormap/world.js}"></script>
	<script th:src="@{/assets/js/plugin/gmaps/gmaps.js}"></script>
	<script th:src="@{/assets/js/plugin/sweetalert/sweetalert.min.js}"></script>
	<script th:src="@{/assets/js/kaiadmin.min.js}"></script>

	<!-- AJAX l·∫•y t·ªïng t√≠n ch·ªâ -->
	<script th:inline="javascript">
/*<![CDATA[*/
document.getElementById('showCredits').addEventListener('click', function() {
    let curriculumCode = document.getElementById('curriculumCode').value;
    let semester = document.getElementById('semester').value;

    if (!curriculumCode || !semester) {
        alert("Vui l√≤ng ch·ªçn CTƒêT v√† h·ªçc k·ª≥");
        return;
    }

    /* D√πng Thymeleaf ƒë·ªÉ build URL ƒë√∫ng */
    let url = /*[[@{/admin/tuition/getCredits}]]*/ '?curriculumCode=' + curriculumCode + '&semester=' + semester;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            document.getElementById('totalCredits').innerText = data;
            document.getElementById('creditResult').style.display = 'block';
        })
        .catch(err => console.error(err));
});
/*]]>*/
</script>

</body>
</html>
